<!DOCTYPE html>
<html>
  <head>
    <title>Graph sensmon</title>
    <link rel="stylesheet" href="style/main.css" type="text/css">
  </head>
  <body>
    <h1>Graph Sensmon. (dynamic)</h1>
    <hr/>
    <span id="dynsparkline">Loading...</span>
	<hr>
	<b>Last Value: <span id="last_value"></span> (<span id="last_stime"></span>)</b>
  </body>
  <script src="/_utils/script/json2.js"></script>
  <script src="/_utils/script/jquery.js?1.3.1"></script>
  <script src="/_utils/script/jquery.couch.js?0.9.0"></script>
  <script src="js/jquery.sparkline.min.js"></script>

<script type="text/javascript" charset="utf-8">
	$(function(){
		gview();
		window.setInterval(function(){
			gview()}, 1000);
	});
	var gview = function(){
		var series = [];
		$.ajax({
			type: 'GET',
			dataType: 'json',
			url: "/sensmon/_design/sensmon/_view/all",
			success: function(data){
				$.each(data.rows, function(id,val){
					series.push(parseInt(val.value.value));
					$("#last_stime").text(val.value.stime);
					$("#last_value").text(val.value.value);
				});
				$("#dynsparkline").sparkline(series,
					{type:'line',
					barColor:'green',
					height:300,
					width:1000,
					});
			}
		});
	};
</script>

</html>
